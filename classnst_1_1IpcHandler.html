<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nst: nst::IpcHandler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">nst
   </div>
   <div id="projectbrief">C++ wrapper for libX11</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classnst_1_1IpcHandler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classnst_1_1IpcHandler-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">nst::IpcHandler Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>UNIX domain socket IPC handler.  
 <a href="classnst_1_1IpcHandler.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ae9208c99024a5eef69d971a27c7df771" id="r_ae9208c99024a5eef69d971a27c7df771"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">Message</a> : uint16_t { <br />
&#160;&#160;<b>INVALID</b> = UINT16_MAX
, <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a2499c9b03e5898da1760a56e166136d8">SNAPSHOT_HISTORY</a> = 1
, <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a8d2b7599499f3541f767650e97067eca">GET_HISTORY</a>
, <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a1408211b3a91bdf30308f79b33a345e4">GET_SNAPSHOT</a>
, <br />
&#160;&#160;<a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1">PING</a>
, <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a240e6ffb4949588c01136f7ab7585aec">GET_CWD</a>
<br />
 }</td></tr>
<tr class="memdesc:ae9208c99024a5eef69d971a27c7df771"><td class="mdescLeft">&#160;</td><td class="mdescRight">Different IPC message types. This is what a client request needs to send in its initial message.  <a href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">More...</a><br /></td></tr>
<tr class="separator:ae9208c99024a5eef69d971a27c7df771"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aaf5d6115b94e74005739fe2185dfac1b" id="r_aaf5d6115b94e74005739fe2185dfac1b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#aaf5d6115b94e74005739fe2185dfac1b">IpcHandler</a> (<a class="el" href="classnst_1_1Nst.html">Nst</a> &amp;nst, cosmos::Poller &amp;poller)</td></tr>
<tr class="memdesc:aaf5d6115b94e74005739fe2185dfac1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create an <a class="el" href="classnst_1_1IpcHandler.html" title="UNIX domain socket IPC handler.">IpcHandler</a>.  <br /></td></tr>
<tr class="separator:aaf5d6115b94e74005739fe2185dfac1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecff26c5514e34703650a0a6e062adb3" id="r_aecff26c5514e34703650a0a6e062adb3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#aecff26c5514e34703650a0a6e062adb3">init</a> ()</td></tr>
<tr class="memdesc:aecff26c5514e34703650a0a6e062adb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the IPC endpoint and start accepting connections.  <br /></td></tr>
<tr class="separator:aecff26c5514e34703650a0a6e062adb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abadb4b15679ff9811334c57364a30aa8" id="r_abadb4b15679ff9811334c57364a30aa8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#abadb4b15679ff9811334c57364a30aa8">checkEvent</a> (const cosmos::Poller::PollEvent &amp;event)</td></tr>
<tr class="memdesc:abadb4b15679ff9811334c57364a30aa8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inspect the given poller event and act on I/O if necessary.  <br /></td></tr>
<tr class="separator:abadb4b15679ff9811334c57364a30aa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ad6386e26c2f60bab6748583e23c52829" id="r_ad6386e26c2f60bab6748583e23c52829"><td class="memItemLeft" align="right" valign="top">static std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#ad6386e26c2f60bab6748583e23c52829">address</a> ()</td></tr>
<tr class="memdesc:ad6386e26c2f60bab6748583e23c52829"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the address used for m_listener.  <br /></td></tr>
<tr class="separator:ad6386e26c2f60bab6748583e23c52829"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-attribs" name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a3baabfd26ec3c24370ed11fe201f5e11" id="r_a3baabfd26ec3c24370ed11fe201f5e11"><td class="memItemLeft" align="right" valign="top">static constexpr size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a3baabfd26ec3c24370ed11fe201f5e11">MAX_CHUNK_SIZE</a> = 1024 * 64</td></tr>
<tr class="memdesc:a3baabfd26ec3c24370ed11fe201f5e11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Largest packet size to send/receive.  <br /></td></tr>
<tr class="separator:a3baabfd26ec3c24370ed11fe201f5e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-types" name="pro-types"></a>
Protected Types</h2></td></tr>
<tr class="memitem:a4eacd6660a0f8dd62476a7b7b58bb59a" id="r_a4eacd6660a0f8dd62476a7b7b58bb59a"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59a">State</a> { <a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50">WAITING</a>
, <a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0">RECEIVING</a>
, <a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568">SENDING</a>
 }</td></tr>
<tr class="memdesc:a4eacd6660a0f8dd62476a7b7b58bb59a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The current state of an IPC session.  <a href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59a">More...</a><br /></td></tr>
<tr class="separator:a4eacd6660a0f8dd62476a7b7b58bb59a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a6c8fcd0f01e08f87297f8a46f7e021ea" id="r_a6c8fcd0f01e08f87297f8a46f7e021ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a6c8fcd0f01e08f87297f8a46f7e021ea">receiveCommand</a> ()</td></tr>
<tr class="memdesc:a6c8fcd0f01e08f87297f8a46f7e021ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles I/O on an IPC connection.  <br /></td></tr>
<tr class="separator:a6c8fcd0f01e08f87297f8a46f7e021ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79a5fc25eda4d8d2a6ec5487c22598d7" id="r_a79a5fc25eda4d8d2a6ec5487c22598d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a79a5fc25eda4d8d2a6ec5487c22598d7">processCommand</a> (const <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">Message</a> message)</td></tr>
<tr class="memdesc:a79a5fc25eda4d8d2a6ec5487c22598d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Once a valid request has been received this processes it.  <br /></td></tr>
<tr class="separator:a79a5fc25eda4d8d2a6ec5487c22598d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b49d54e6ee582d6e5c643f2dfcec40d" id="r_a8b49d54e6ee582d6e5c643f2dfcec40d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a8b49d54e6ee582d6e5c643f2dfcec40d">sendData</a> ()</td></tr>
<tr class="memdesc:a8b49d54e6ee582d6e5c643f2dfcec40d"><td class="mdescLeft">&#160;</td><td class="mdescRight">If we need to reply with data then this manages the transmission.  <br /></td></tr>
<tr class="separator:a8b49d54e6ee582d6e5c643f2dfcec40d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1703e0b041aee1228bca9b5aba2afc73" id="r_a1703e0b041aee1228bca9b5aba2afc73"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a> ()</td></tr>
<tr class="memdesc:a1703e0b041aee1228bca9b5aba2afc73"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes all session state and accepts new connections again.  <br /></td></tr>
<tr class="separator:a1703e0b041aee1228bca9b5aba2afc73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48a6b742d6c0fcdec15587f2a0cae5de" id="r_a48a6b742d6c0fcdec15587f2a0cae5de"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a48a6b742d6c0fcdec15587f2a0cae5de">history</a> () const</td></tr>
<tr class="memdesc:a48a6b742d6c0fcdec15587f2a0cae5de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the current history buffer.  <br /></td></tr>
<tr class="separator:a48a6b742d6c0fcdec15587f2a0cae5de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2527478271def1ce8e7fb469904205e5" id="r_a2527478271def1ce8e7fb469904205e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a2527478271def1ce8e7fb469904205e5">acceptConnection</a> ()</td></tr>
<tr class="memdesc:a2527478271def1ce8e7fb469904205e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accept a new connection, checking the peer's permissions.  <br /></td></tr>
<tr class="separator:a2527478271def1ce8e7fb469904205e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a252e45648a8528784e3628a9c721ec12" id="r_a252e45648a8528784e3628a9c721ec12"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a252e45648a8528784e3628a9c721ec12">childCWD</a> () const</td></tr>
<tr class="separator:a252e45648a8528784e3628a9c721ec12"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a9b9194ec7d4facf229d58bd44f14a312" id="r_a9b9194ec7d4facf229d58bd44f14a312"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classnst_1_1Nst.html">Nst</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a9b9194ec7d4facf229d58bd44f14a312">m_nst</a></td></tr>
<tr class="separator:a9b9194ec7d4facf229d58bd44f14a312"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa94db5d221039844a7228b282faf35ea" id="r_aa94db5d221039844a7228b282faf35ea"><td class="memItemLeft" align="right" valign="top">cosmos::Poller &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#aa94db5d221039844a7228b282faf35ea">m_poller</a></td></tr>
<tr class="separator:aa94db5d221039844a7228b282faf35ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaa92e233276ba2ccdbe39e81c810d13" id="r_adaa92e233276ba2ccdbe39e81c810d13"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59a">State</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#adaa92e233276ba2ccdbe39e81c810d13">m_state</a> = <a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50">State::WAITING</a></td></tr>
<tr class="separator:adaa92e233276ba2ccdbe39e81c810d13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48db42a02bbd9273589a95ab6b0cf5f4" id="r_a48db42a02bbd9273589a95ab6b0cf5f4"><td class="memItemLeft" align="right" valign="top">cosmos::UnixSeqPacketListenSocket&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a48db42a02bbd9273589a95ab6b0cf5f4">m_listener</a></td></tr>
<tr class="separator:a48db42a02bbd9273589a95ab6b0cf5f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a786e9d8ad9323a131a037d4713cd2d11" id="r_a786e9d8ad9323a131a037d4713cd2d11"><td class="memItemLeft" align="right" valign="top">std::optional&lt; cosmos::UnixConnection &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a786e9d8ad9323a131a037d4713cd2d11">m_connection</a></td></tr>
<tr class="separator:a786e9d8ad9323a131a037d4713cd2d11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1c8fec849af21f3b749eb75909489d3" id="r_aa1c8fec849af21f3b749eb75909489d3"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#aa1c8fec849af21f3b749eb75909489d3">m_snapshot</a></td></tr>
<tr class="separator:aa1c8fec849af21f3b749eb75909489d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a418c4e95a193eee4757c2da2bfc92120" id="r_a418c4e95a193eee4757c2da2bfc92120"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a418c4e95a193eee4757c2da2bfc92120">m_send_data</a></td></tr>
<tr class="separator:a418c4e95a193eee4757c2da2bfc92120"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87ae8e1bd29af462f23708a1236f7acf" id="r_a87ae8e1bd29af462f23708a1236f7acf"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnst_1_1IpcHandler.html#a87ae8e1bd29af462f23708a1236f7acf">m_send_pos</a> = 0</td></tr>
<tr class="separator:a87ae8e1bd29af462f23708a1236f7acf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>UNIX domain socket IPC handler. </p>
<p>This class deals with IPC socket requests.</p>
<p>nst is listening on an abstract UNIX domain socket path for client connections to access its interface. Currently the IPC is mainly used for accessing the terminal screen and history contents.</p>
<p>Only one session is allowed in parallel. Either the listener socket is monitored in the Poller for new connection requests, or an active connection is monitored for I/O.</p>
<p>Clients send a request in form of an <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771" title="Different IPC message types. This is what a client request needs to send in its initial message.">IpcHandler::Message</a> value. The <a class="el" href="classnst_1_1IpcHandler.html" title="UNIX domain socket IPC handler.">IpcHandler</a> processes requests and replies with data, if applicable. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00032">32</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="ae9208c99024a5eef69d971a27c7df771" name="ae9208c99024a5eef69d971a27c7df771"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9208c99024a5eef69d971a27c7df771">&#9670;&#160;</a></span>Message</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">nst::IpcHandler::Message</a> : uint16_t</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Different IPC message types. This is what a client request needs to send in its initial message. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ae9208c99024a5eef69d971a27c7df771a2499c9b03e5898da1760a56e166136d8" name="ae9208c99024a5eef69d971a27c7df771a2499c9b03e5898da1760a56e166136d8"></a>SNAPSHOT_HISTORY&#160;</td><td class="fielddoc"><p>Store a snapshot of the current terminal history to operate on. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae9208c99024a5eef69d971a27c7df771a8d2b7599499f3541f767650e97067eca" name="ae9208c99024a5eef69d971a27c7df771a8d2b7599499f3541f767650e97067eca"></a>GET_HISTORY&#160;</td><td class="fielddoc"><p>Get the current terminal buffer (including history) content. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae9208c99024a5eef69d971a27c7df771a1408211b3a91bdf30308f79b33a345e4" name="ae9208c99024a5eef69d971a27c7df771a1408211b3a91bdf30308f79b33a345e4"></a>GET_SNAPSHOT&#160;</td><td class="fielddoc"><p>Get the complete terminal buffer stored in the last snapshot. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1" name="ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1"></a>PING&#160;</td><td class="fielddoc"><p>Test message that triggers an identical reply. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae9208c99024a5eef69d971a27c7df771a240e6ffb4949588c01136f7ab7585aec" name="ae9208c99024a5eef69d971a27c7df771a240e6ffb4949588c01136f7ab7585aec"></a>GET_CWD&#160;</td><td class="fielddoc"><p>Send the current working directory of the terminal's child process. </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00057">57</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   57</span>                           : uint16_t {</div>
<div class="line"><span class="lineno">   58</span>                INVALID = UINT16_MAX,</div>
<div class="line"><span class="lineno">   60</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a2499c9b03e5898da1760a56e166136d8">SNAPSHOT_HISTORY</a> = 1,</div>
<div class="line"><span class="lineno">   62</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a8d2b7599499f3541f767650e97067eca">GET_HISTORY</a>,</div>
<div class="line"><span class="lineno">   64</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a1408211b3a91bdf30308f79b33a345e4">GET_SNAPSHOT</a>,</div>
<div class="line"><span class="lineno">   66</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1">PING</a>,</div>
<div class="line"><span class="lineno">   68</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a240e6ffb4949588c01136f7ab7585aec">GET_CWD</a>,</div>
<div class="line"><span class="lineno">   69</span>        };</div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_ae9208c99024a5eef69d971a27c7df771a1408211b3a91bdf30308f79b33a345e4"><div class="ttname"><a href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a1408211b3a91bdf30308f79b33a345e4">nst::IpcHandler::Message::GET_SNAPSHOT</a></div><div class="ttdeci">@ GET_SNAPSHOT</div><div class="ttdoc">Get the complete terminal buffer stored in the last snapshot.</div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_ae9208c99024a5eef69d971a27c7df771a240e6ffb4949588c01136f7ab7585aec"><div class="ttname"><a href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a240e6ffb4949588c01136f7ab7585aec">nst::IpcHandler::Message::GET_CWD</a></div><div class="ttdeci">@ GET_CWD</div><div class="ttdoc">Send the current working directory of the terminal's child process.</div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_ae9208c99024a5eef69d971a27c7df771a2499c9b03e5898da1760a56e166136d8"><div class="ttname"><a href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a2499c9b03e5898da1760a56e166136d8">nst::IpcHandler::Message::SNAPSHOT_HISTORY</a></div><div class="ttdeci">@ SNAPSHOT_HISTORY</div><div class="ttdoc">Store a snapshot of the current terminal history to operate on.</div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_ae9208c99024a5eef69d971a27c7df771a8d2b7599499f3541f767650e97067eca"><div class="ttname"><a href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a8d2b7599499f3541f767650e97067eca">nst::IpcHandler::Message::GET_HISTORY</a></div><div class="ttdeci">@ GET_HISTORY</div><div class="ttdoc">Get the current terminal buffer (including history) content.</div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1"><div class="ttname"><a href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1">nst::IpcHandler::Message::PING</a></div><div class="ttdeci">@ PING</div><div class="ttdoc">Test message that triggers an identical reply.</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4eacd6660a0f8dd62476a7b7b58bb59a" name="a4eacd6660a0f8dd62476a7b7b58bb59a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4eacd6660a0f8dd62476a7b7b58bb59a">&#9670;&#160;</a></span>State</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59a">nst::IpcHandler::State</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The current state of an IPC session. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50" name="a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50"></a>WAITING&#160;</td><td class="fielddoc"><p>Waiting for new connections. </p>
</td></tr>
<tr><td class="fieldname"><a id="a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0" name="a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0"></a>RECEIVING&#160;</td><td class="fielddoc"><p>A connection is being processed, request is being collected. </p>
</td></tr>
<tr><td class="fieldname"><a id="a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568" name="a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568"></a>SENDING&#160;</td><td class="fielddoc"><p>Ongoing transmission to fulfill a request. </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00079">79</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   79</span>                         {</div>
<div class="line"><span class="lineno">   81</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50">WAITING</a>,</div>
<div class="line"><span class="lineno">   83</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0">RECEIVING</a>,</div>
<div class="line"><span class="lineno">   85</span>                <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568">SENDING</a></div>
<div class="line"><span class="lineno">   86</span>        };</div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0">nst::IpcHandler::State::RECEIVING</a></div><div class="ttdeci">@ RECEIVING</div><div class="ttdoc">A connection is being processed, request is being collected.</div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50">nst::IpcHandler::State::WAITING</a></div><div class="ttdeci">@ WAITING</div><div class="ttdoc">Waiting for new connections.</div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568">nst::IpcHandler::State::SENDING</a></div><div class="ttdeci">@ SENDING</div><div class="ttdoc">Ongoing transmission to fulfill a request.</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aaf5d6115b94e74005739fe2185dfac1b" name="aaf5d6115b94e74005739fe2185dfac1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf5d6115b94e74005739fe2185dfac1b">&#9670;&#160;</a></span>IpcHandler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">nst::IpcHandler::IpcHandler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnst_1_1Nst.html">Nst</a> &amp;&#160;</td>
          <td class="paramname"><em>nst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cosmos::Poller &amp;&#160;</td>
          <td class="paramname"><em>poller</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create an <a class="el" href="classnst_1_1IpcHandler.html" title="UNIX domain socket IPC handler.">IpcHandler</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">poller</td><td>The Poller object used in the nst main loop. <a class="el" href="classnst_1_1IpcHandler.html" title="UNIX domain socket IPC handler.">IpcHandler</a> needs to adjust which sockets are monitored for which I/O events. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00041">41</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   41</span>                                                            :</div>
<div class="line"><span class="lineno">   42</span>                        m_nst{nst},</div>
<div class="line"><span class="lineno">   43</span>                        m_poller{poller} {}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2527478271def1ce8e7fb469904205e5" name="a2527478271def1ce8e7fb469904205e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2527478271def1ce8e7fb469904205e5">&#9670;&#160;</a></span>acceptConnection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nst::IpcHandler::acceptConnection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Accept a new connection, checking the peer's permissions. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00062">62</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   62</span>                                  {</div>
<div class="line"><span class="lineno">   63</span>        m_connection = m_listener.accept();</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>        <span class="keyword">auto</span> opts = m_connection-&gt;unixOptions();</div>
<div class="line"><span class="lineno">   66</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> peer_uid = opts.credentials().userID(); peer_uid != cosmos::proc::get_real_user_id()) {</div>
<div class="line"><span class="lineno">   67</span>                log_error() &lt;&lt; <span class="stringliteral">&quot;rejecting connection from uid &quot;</span> &lt;&lt; cosmos::to_integral(peer_uid) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno">   68</span>                m_connection-&gt;close();</div>
<div class="line"><span class="lineno">   69</span>                m_connection.reset();</div>
<div class="line"><span class="lineno">   70</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   71</span>        }</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>        m_poller.delFD(m_listener.fd());</div>
<div class="line"><span class="lineno">   74</span>        m_poller.addFD(m_connection-&gt;fd(), {cosmos::Poller::MonitorFlag::INPUT});</div>
<div class="line"><span class="lineno">   75</span>        m_state = <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0">State::RECEIVING</a>;</div>
<div class="line"><span class="lineno">   76</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad6386e26c2f60bab6748583e23c52829" name="ad6386e26c2f60bab6748583e23c52829"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6386e26c2f60bab6748583e23c52829">&#9670;&#160;</a></span>address()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string nst::IpcHandler::address </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the address used for m_listener. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00023">23</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   23</span>                              {</div>
<div class="line"><span class="lineno">   24</span>        std::string ret{<span class="stringliteral">&quot;nst-ipc-&quot;</span>};</div>
<div class="line"><span class="lineno">   25</span>        <span class="keyword">const</span> <span class="keyword">auto</span> pid = cosmos::proc::cached_pids.own_pid;</div>
<div class="line"><span class="lineno">   26</span> </div>
<div class="line"><span class="lineno">   27</span>        ret.append(std::to_string(cosmos::to_integral(pid)));</div>
<div class="line"><span class="lineno">   28</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">   29</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="abadb4b15679ff9811334c57364a30aa8" name="abadb4b15679ff9811334c57364a30aa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abadb4b15679ff9811334c57364a30aa8">&#9670;&#160;</a></span>checkEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nst::IpcHandler::checkEvent </td>
          <td>(</td>
          <td class="paramtype">const cosmos::Poller::PollEvent &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inspect the given poller event and act on I/O if necessary. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00037">37</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   37</span>                                                              {</div>
<div class="line"><span class="lineno">   38</span>        <span class="keywordflow">if</span> (m_state == <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50">State::WAITING</a>) {</div>
<div class="line"><span class="lineno">   39</span>                <span class="keywordflow">if</span> (event.fd() == m_listener.fd()) {</div>
<div class="line"><span class="lineno">   40</span>                        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">   41</span>                                <a class="code hl_function" href="classnst_1_1IpcHandler.html#a2527478271def1ce8e7fb469904205e5">acceptConnection</a>();</div>
<div class="line"><span class="lineno">   42</span>                        } <span class="keywordflow">catch</span> (<span class="keyword">const</span> cosmos::ApiError &amp;e) {</div>
<div class="line"><span class="lineno">   43</span>                                log_error() &lt;&lt; e.what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno">   44</span>                        }</div>
<div class="line"><span class="lineno">   45</span>                }</div>
<div class="line"><span class="lineno">   46</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event.fd() == m_connection-&gt;fd()) {</div>
<div class="line"><span class="lineno">   47</span>                <span class="keywordflow">switch</span> (m_state) {</div>
<div class="line"><span class="lineno">   48</span>                        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa0c96084902e8f21bf3bf678fdce4f2a0">State::RECEIVING</a>:</div>
<div class="line"><span class="lineno">   49</span>                                <a class="code hl_function" href="classnst_1_1IpcHandler.html#a6c8fcd0f01e08f87297f8a46f7e021ea">receiveCommand</a>();</div>
<div class="line"><span class="lineno">   50</span>                                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   51</span>                        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568">State::SENDING</a>:</div>
<div class="line"><span class="lineno">   52</span>                                <a class="code hl_function" href="classnst_1_1IpcHandler.html#a8b49d54e6ee582d6e5c643f2dfcec40d">sendData</a>();</div>
<div class="line"><span class="lineno">   53</span>                                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   54</span>                        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">   55</span>                                log_error() &lt;&lt; <span class="stringliteral">&quot;bad IPC state, closing session\n&quot;</span>;</div>
<div class="line"><span class="lineno">   56</span>                                <a class="code hl_function" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a>();</div>
<div class="line"><span class="lineno">   57</span>                                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   58</span>                }</div>
<div class="line"><span class="lineno">   59</span>        }</div>
<div class="line"><span class="lineno">   60</span>}</div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a1703e0b041aee1228bca9b5aba2afc73"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">nst::IpcHandler::closeSession</a></div><div class="ttdeci">void closeSession()</div><div class="ttdoc">Closes all session state and accepts new connections again.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8cxx_source.html#l00172">IpcHandler.cxx:172</a></div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a2527478271def1ce8e7fb469904205e5"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a2527478271def1ce8e7fb469904205e5">nst::IpcHandler::acceptConnection</a></div><div class="ttdeci">void acceptConnection()</div><div class="ttdoc">Accept a new connection, checking the peer's permissions.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8cxx_source.html#l00062">IpcHandler.cxx:62</a></div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a6c8fcd0f01e08f87297f8a46f7e021ea"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a6c8fcd0f01e08f87297f8a46f7e021ea">nst::IpcHandler::receiveCommand</a></div><div class="ttdeci">void receiveCommand()</div><div class="ttdoc">Handles I/O on an IPC connection.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8cxx_source.html#l00078">IpcHandler.cxx:78</a></div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a8b49d54e6ee582d6e5c643f2dfcec40d"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a8b49d54e6ee582d6e5c643f2dfcec40d">nst::IpcHandler::sendData</a></div><div class="ttdeci">void sendData()</div><div class="ttdoc">If we need to reply with data then this manages the transmission.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8cxx_source.html#l00157">IpcHandler.cxx:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a252e45648a8528784e3628a9c721ec12" name="a252e45648a8528784e3628a9c721ec12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a252e45648a8528784e3628a9c721ec12">&#9670;&#160;</a></span>childCWD()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string nst::IpcHandler::childCWD </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00186">186</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  186</span>                                     {</div>
<div class="line"><span class="lineno">  187</span>        <span class="keyword">const</span> <span class="keyword">auto</span> pid = m_nst.tty().<a class="code hl_function" href="classnst_1_1TTY.html#ad92d5c2a45c082e7cba2ba32a8739697">childPID</a>();</div>
<div class="line"><span class="lineno">  188</span>        <span class="comment">// NOTE: this does currently not take into account possible</span></div>
<div class="line"><span class="lineno">  189</span>        <span class="comment">// inter-mediate processes like a `scroll` helper program. In this</span></div>
<div class="line"><span class="lineno">  190</span>        <span class="comment">// case we&#39;d need the grandchildren CWD (the shell).</span></div>
<div class="line"><span class="lineno">  191</span>        std::string str = cosmos::sprintf(</div>
<div class="line"><span class="lineno">  192</span>                        <span class="stringliteral">&quot;/proc/%s/cwd&quot;</span>,</div>
<div class="line"><span class="lineno">  193</span>                        std::to_string(cosmos::to_integral(pid)).c_str());</div>
<div class="line"><span class="lineno">  194</span>        <span class="keywordflow">return</span> cosmos::fs::read_symlink(str);</div>
<div class="line"><span class="lineno">  195</span>}</div>
<div class="ttc" id="aclassnst_1_1TTY_html_ad92d5c2a45c082e7cba2ba32a8739697"><div class="ttname"><a href="classnst_1_1TTY.html#ad92d5c2a45c082e7cba2ba32a8739697">nst::TTY::childPID</a></div><div class="ttdeci">auto childPID()</div><div class="ttdoc">Returns the current child process's PID.</div><div class="ttdef"><b>Definition</b> <a href="TTY_8hxx_source.html#l00077">TTY.hxx:77</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1703e0b041aee1228bca9b5aba2afc73" name="a1703e0b041aee1228bca9b5aba2afc73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1703e0b041aee1228bca9b5aba2afc73">&#9670;&#160;</a></span>closeSession()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nst::IpcHandler::closeSession </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Closes all session state and accepts new connections again. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00172">172</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  172</span>                              {</div>
<div class="line"><span class="lineno">  173</span>        m_state = <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50">State::WAITING</a>;</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>        <span class="keywordflow">if</span> (!m_connection)</div>
<div class="line"><span class="lineno">  176</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>        m_poller.addFD(m_listener.fd(), {cosmos::Poller::MonitorFlag::INPUT});</div>
<div class="line"><span class="lineno">  179</span>        m_poller.delFD(m_connection-&gt;fd());</div>
<div class="line"><span class="lineno">  180</span>        m_connection-&gt;close();</div>
<div class="line"><span class="lineno">  181</span>        m_connection.reset();</div>
<div class="line"><span class="lineno">  182</span>        m_send_data.clear();</div>
<div class="line"><span class="lineno">  183</span>        m_send_pos = 0;</div>
<div class="line"><span class="lineno">  184</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a48a6b742d6c0fcdec15587f2a0cae5de" name="a48a6b742d6c0fcdec15587f2a0cae5de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48a6b742d6c0fcdec15587f2a0cae5de">&#9670;&#160;</a></span>history()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string nst::IpcHandler::history </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the current history buffer. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00109">109</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  109</span>                                    {</div>
<div class="line"><span class="lineno">  110</span>        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;term = m_nst.term();</div>
<div class="line"><span class="lineno">  111</span>        <span class="keyword">auto</span> ret = term.screen().asText(term.cursor());</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span>        <span class="keywordflow">if</span> (!term.onAltScreen()) {</div>
<div class="line"><span class="lineno">  114</span>                <span class="comment">// drop the last line which contains the currently entered</span></div>
<div class="line"><span class="lineno">  115</span>                <span class="comment">// command line. this avoids that e.g.</span></div>
<div class="line"><span class="lineno">  116</span>                <span class="comment">//     nst-msg -d | grep something</span></div>
<div class="line"><span class="lineno">  117</span>                <span class="comment">// matches the very command line that searches for `something`.</span></div>
<div class="line"><span class="lineno">  118</span>                <span class="comment">// TODO: this is currently not unicode safe ...</span></div>
<div class="line"><span class="lineno">  119</span>                <span class="keyword">auto</span> pos = ret.find_last_of(<span class="charliteral">&#39;\n&#39;</span>, ret.size() &gt;= 2 ? ret.size() - 2 : ret.npos);</div>
<div class="line"><span class="lineno">  120</span>                <span class="keywordflow">if</span> (pos != ret.npos) {</div>
<div class="line"><span class="lineno">  121</span>                        ret.erase(pos+1);</div>
<div class="line"><span class="lineno">  122</span>                }</div>
<div class="line"><span class="lineno">  123</span>        }</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  126</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aecff26c5514e34703650a0a6e062adb3" name="aecff26c5514e34703650a0a6e062adb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecff26c5514e34703650a0a6e062adb3">&#9670;&#160;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nst::IpcHandler::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create the IPC endpoint and start accepting connections. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00031">31</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   31</span>                      {</div>
<div class="line"><span class="lineno">   32</span>        m_listener.bind(cosmos::UnixAddress{<a class="code hl_function" href="classnst_1_1IpcHandler.html#ad6386e26c2f60bab6748583e23c52829">address</a>(), cosmos::UnixAddress::Abstract{<span class="keyword">true</span>}});</div>
<div class="line"><span class="lineno">   33</span>        m_listener.listen(5);</div>
<div class="line"><span class="lineno">   34</span>        m_poller.addFD(m_listener.fd(), {cosmos::Poller::MonitorFlag::INPUT});</div>
<div class="line"><span class="lineno">   35</span>}</div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_ad6386e26c2f60bab6748583e23c52829"><div class="ttname"><a href="classnst_1_1IpcHandler.html#ad6386e26c2f60bab6748583e23c52829">nst::IpcHandler::address</a></div><div class="ttdeci">static std::string address()</div><div class="ttdoc">Returns the address used for m_listener.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8cxx_source.html#l00023">IpcHandler.cxx:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79a5fc25eda4d8d2a6ec5487c22598d7" name="a79a5fc25eda4d8d2a6ec5487c22598d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79a5fc25eda4d8d2a6ec5487c22598d7">&#9670;&#160;</a></span>processCommand()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nst::IpcHandler::processCommand </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">Message</a>&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Once a valid request has been received this processes it. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00128">128</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  128</span>                                                     {</div>
<div class="line"><span class="lineno">  129</span>        <span class="keywordflow">switch</span> (message) {</div>
<div class="line"><span class="lineno">  130</span>                <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  131</span>                        log_error() &lt;&lt; <span class="stringliteral">&quot;bad request received: &quot;</span> &lt;&lt; cosmos::to_integral(message) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno">  132</span>                        <a class="code hl_function" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a>();</div>
<div class="line"><span class="lineno">  133</span>                        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  134</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a2499c9b03e5898da1760a56e166136d8">Message::SNAPSHOT_HISTORY</a>:</div>
<div class="line"><span class="lineno">  135</span>                        m_snapshot = <a class="code hl_function" href="classnst_1_1IpcHandler.html#a48a6b742d6c0fcdec15587f2a0cae5de">history</a>();</div>
<div class="line"><span class="lineno">  136</span>                        <a class="code hl_function" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a>();</div>
<div class="line"><span class="lineno">  137</span>                        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  138</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a8d2b7599499f3541f767650e97067eca">Message::GET_HISTORY</a>:</div>
<div class="line"><span class="lineno">  139</span>                        m_send_data = <a class="code hl_function" href="classnst_1_1IpcHandler.html#a48a6b742d6c0fcdec15587f2a0cae5de">history</a>();</div>
<div class="line"><span class="lineno">  140</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  141</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a1408211b3a91bdf30308f79b33a345e4">Message::GET_SNAPSHOT</a>:</div>
<div class="line"><span class="lineno">  142</span>                        m_send_data = m_snapshot;</div>
<div class="line"><span class="lineno">  143</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  144</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771a240e6ffb4949588c01136f7ab7585aec">Message::GET_CWD</a>:</div>
<div class="line"><span class="lineno">  145</span>                        m_send_data = childCWD();</div>
<div class="line"><span class="lineno">  146</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  147</span>                <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1">Message::PING</a>:</div>
<div class="line"><span class="lineno">  148</span>                        <span class="keyword">constexpr</span> <span class="keyword">auto</span> msg = <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771ae07ff41a486c27c095a15898dcca34d1">Message::PING</a>;</div>
<div class="line"><span class="lineno">  149</span>                        m_send_data.resize(<span class="keyword">sizeof</span>(msg));</div>
<div class="line"><span class="lineno">  150</span>                        std::memcpy(m_send_data.data(), &amp;msg, <span class="keyword">sizeof</span>(msg));</div>
<div class="line"><span class="lineno">  151</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  152</span>        }</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>        m_state = <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568">State::SENDING</a>;</div>
<div class="line"><span class="lineno">  155</span>}</div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a48a6b742d6c0fcdec15587f2a0cae5de"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a48a6b742d6c0fcdec15587f2a0cae5de">nst::IpcHandler::history</a></div><div class="ttdeci">std::string history() const</div><div class="ttdoc">Returns the current history buffer.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8cxx_source.html#l00109">IpcHandler.cxx:109</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6c8fcd0f01e08f87297f8a46f7e021ea" name="a6c8fcd0f01e08f87297f8a46f7e021ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c8fcd0f01e08f87297f8a46f7e021ea">&#9670;&#160;</a></span>receiveCommand()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nst::IpcHandler::receiveCommand </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles I/O on an IPC connection. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00078">78</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   78</span>                                {</div>
<div class="line"><span class="lineno">   79</span>        <span class="keyword">auto</span> &amp;connection = *m_connection;</div>
<div class="line"><span class="lineno">   80</span>        <a class="code hl_enumeration" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">Message</a> message = Message::INVALID;</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>        <span class="keywordtype">size_t</span> len = 0;</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">   85</span>                len = connection.receive(&amp;message, <span class="keyword">sizeof</span>(<a class="code hl_enumeration" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">Message</a>), cosmos::MessageFlags{cosmos::MessageFlag::TRUNCATE});</div>
<div class="line"><span class="lineno">   86</span>        } <span class="keywordflow">catch</span> (<span class="keyword">const</span> cosmos::ApiError &amp;error) {</div>
<div class="line"><span class="lineno">   87</span>                log_error() &lt;&lt; <span class="stringliteral">&quot;receive error: &quot;</span> &lt;&lt; error.what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno">   88</span>                <a class="code hl_function" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a>();</div>
<div class="line"><span class="lineno">   89</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   90</span>        }</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>        <span class="keywordflow">if</span> (len != <span class="keyword">sizeof</span>(<a class="code hl_enumeration" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">Message</a>)) {</div>
<div class="line"><span class="lineno">   93</span>                <span class="keywordflow">if</span> (len &lt; <span class="keyword">sizeof</span>(<a class="code hl_enumeration" href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">Message</a>))</div>
<div class="line"><span class="lineno">   94</span>                        log_error() &lt;&lt; <span class="stringliteral">&quot;short IPC message, closing session.\n&quot;</span>;</div>
<div class="line"><span class="lineno">   95</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   96</span>                        log_error() &lt;&lt; <span class="stringliteral">&quot;too long (truncated) IPC message, closing session.\n&quot;</span>;</div>
<div class="line"><span class="lineno">   97</span>                <a class="code hl_function" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a>();</div>
<div class="line"><span class="lineno">   98</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   99</span>        }</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>        <a class="code hl_function" href="classnst_1_1IpcHandler.html#a79a5fc25eda4d8d2a6ec5487c22598d7">processCommand</a>(message);</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>        <span class="keywordflow">if</span> (m_state == <a class="code hl_enumvalue" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aac9c9fa46a3628497a4e7f74444ae4568">State::SENDING</a>) {</div>
<div class="line"><span class="lineno">  104</span>                <span class="comment">// transitioned to sending, we need to monitor output now</span></div>
<div class="line"><span class="lineno">  105</span>                m_poller.modFD(connection.fd(), {cosmos::Poller::MonitorFlag::OUTPUT});</div>
<div class="line"><span class="lineno">  106</span>        }</div>
<div class="line"><span class="lineno">  107</span>}</div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a79a5fc25eda4d8d2a6ec5487c22598d7"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a79a5fc25eda4d8d2a6ec5487c22598d7">nst::IpcHandler::processCommand</a></div><div class="ttdeci">void processCommand(const Message message)</div><div class="ttdoc">Once a valid request has been received this processes it.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8cxx_source.html#l00128">IpcHandler.cxx:128</a></div></div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_ae9208c99024a5eef69d971a27c7df771"><div class="ttname"><a href="classnst_1_1IpcHandler.html#ae9208c99024a5eef69d971a27c7df771">nst::IpcHandler::Message</a></div><div class="ttdeci">Message</div><div class="ttdoc">Different IPC message types. This is what a client request needs to send in its initial message.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8hxx_source.html#l00057">IpcHandler.hxx:57</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8b49d54e6ee582d6e5c643f2dfcec40d" name="a8b49d54e6ee582d6e5c643f2dfcec40d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b49d54e6ee582d6e5c643f2dfcec40d">&#9670;&#160;</a></span>sendData()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void nst::IpcHandler::sendData </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If we need to reply with data then this manages the transmission. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8cxx_source.html#l00157">157</a> of file <a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  157</span>                          {</div>
<div class="line"><span class="lineno">  158</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  159</span>                <span class="keyword">const</span> <span class="keyword">auto</span> to_send = std::min(m_send_data.size() - m_send_pos, <a class="code hl_variable" href="classnst_1_1IpcHandler.html#a3baabfd26ec3c24370ed11fe201f5e11">MAX_CHUNK_SIZE</a>);</div>
<div class="line"><span class="lineno">  160</span>                <span class="keyword">const</span> <span class="keyword">auto</span> sent = m_connection-&gt;send(m_send_data.data() + m_send_pos, to_send);</div>
<div class="line"><span class="lineno">  161</span>                m_send_pos += sent;</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>                <span class="keywordflow">if</span> (m_send_pos &gt;= m_send_data.size()) {</div>
<div class="line"><span class="lineno">  164</span>                        <a class="code hl_function" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a>();</div>
<div class="line"><span class="lineno">  165</span>                }</div>
<div class="line"><span class="lineno">  166</span>        } <span class="keywordflow">catch</span>(<span class="keyword">const</span> cosmos::ApiError &amp;e) {</div>
<div class="line"><span class="lineno">  167</span>                log_error() &lt;&lt; <span class="stringliteral">&quot;failed to send IPC message: &quot;</span> &lt;&lt; e.what() &lt;&lt; <span class="stringliteral">&quot;. Closing session.\n&quot;</span>;</div>
<div class="line"><span class="lineno">  168</span>                <a class="code hl_function" href="classnst_1_1IpcHandler.html#a1703e0b041aee1228bca9b5aba2afc73">closeSession</a>();</div>
<div class="line"><span class="lineno">  169</span>        }</div>
<div class="line"><span class="lineno">  170</span>}</div>
<div class="ttc" id="aclassnst_1_1IpcHandler_html_a3baabfd26ec3c24370ed11fe201f5e11"><div class="ttname"><a href="classnst_1_1IpcHandler.html#a3baabfd26ec3c24370ed11fe201f5e11">nst::IpcHandler::MAX_CHUNK_SIZE</a></div><div class="ttdeci">static constexpr size_t MAX_CHUNK_SIZE</div><div class="ttdoc">Largest packet size to send/receive.</div><div class="ttdef"><b>Definition</b> <a href="IpcHandler_8hxx_source.html#l00074">IpcHandler.hxx:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a786e9d8ad9323a131a037d4713cd2d11" name="a786e9d8ad9323a131a037d4713cd2d11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a786e9d8ad9323a131a037d4713cd2d11">&#9670;&#160;</a></span>m_connection</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt;cosmos::UnixConnection&gt; nst::IpcHandler::m_connection</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00116">116</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="a48db42a02bbd9273589a95ab6b0cf5f4" name="a48db42a02bbd9273589a95ab6b0cf5f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48db42a02bbd9273589a95ab6b0cf5f4">&#9670;&#160;</a></span>m_listener</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cosmos::UnixSeqPacketListenSocket nst::IpcHandler::m_listener</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00115">115</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="a9b9194ec7d4facf229d58bd44f14a312" name="a9b9194ec7d4facf229d58bd44f14a312"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b9194ec7d4facf229d58bd44f14a312">&#9670;&#160;</a></span>m_nst</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classnst_1_1Nst.html">Nst</a>&amp; nst::IpcHandler::m_nst</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00112">112</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="aa94db5d221039844a7228b282faf35ea" name="aa94db5d221039844a7228b282faf35ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa94db5d221039844a7228b282faf35ea">&#9670;&#160;</a></span>m_poller</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cosmos::Poller&amp; nst::IpcHandler::m_poller</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00113">113</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="a418c4e95a193eee4757c2da2bfc92120" name="a418c4e95a193eee4757c2da2bfc92120"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a418c4e95a193eee4757c2da2bfc92120">&#9670;&#160;</a></span>m_send_data</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string nst::IpcHandler::m_send_data</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00118">118</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="a87ae8e1bd29af462f23708a1236f7acf" name="a87ae8e1bd29af462f23708a1236f7acf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87ae8e1bd29af462f23708a1236f7acf">&#9670;&#160;</a></span>m_send_pos</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t nst::IpcHandler::m_send_pos = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00119">119</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="aa1c8fec849af21f3b749eb75909489d3" name="aa1c8fec849af21f3b749eb75909489d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1c8fec849af21f3b749eb75909489d3">&#9670;&#160;</a></span>m_snapshot</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string nst::IpcHandler::m_snapshot</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00117">117</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="adaa92e233276ba2ccdbe39e81c810d13" name="adaa92e233276ba2ccdbe39e81c810d13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaa92e233276ba2ccdbe39e81c810d13">&#9670;&#160;</a></span>m_state</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59a">State</a> nst::IpcHandler::m_state = <a class="el" href="classnst_1_1IpcHandler.html#a4eacd6660a0f8dd62476a7b7b58bb59aa1869d56535e8b1449a6da54ff5e11f50">State::WAITING</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00114">114</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<a id="a3baabfd26ec3c24370ed11fe201f5e11" name="a3baabfd26ec3c24370ed11fe201f5e11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3baabfd26ec3c24370ed11fe201f5e11">&#9670;&#160;</a></span>MAX_CHUNK_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr size_t nst::IpcHandler::MAX_CHUNK_SIZE = 1024 * 64</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Largest packet size to send/receive. </p>

<p class="definition">Definition at line <a class="el" href="IpcHandler_8hxx_source.html#l00074">74</a> of file <a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="IpcHandler_8hxx_source.html">IpcHandler.hxx</a></li>
<li>src/<a class="el" href="IpcHandler_8cxx_source.html">IpcHandler.cxx</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>nst</b></li><li class="navelem"><a class="el" href="classnst_1_1IpcHandler.html">IpcHandler</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
